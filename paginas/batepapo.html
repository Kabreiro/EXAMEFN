<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Entrar no Bate-papo</title>
</head>
<body>
  <h1>Entrar no Bate-papo</h1>
  <form method="POST" action="/entrarBatepapo">
    <label>
      Digite seu nickname cadastrado:<br>
      <input type="text" name="nickname" id="nickname" required />
    </label>
    <br><br>
    <label>
      Assunto:<br>
      <select name="assunto" id="assunto" required>
        <option value="">--Informe um nickname válido--</option>
      </select>
    </label>
    <br><br>
    <button>Entrar</button>
  </form>
  <br>
  <a href="/menu.html">Voltar ao menu</a>

  <script>
    const nicknameInput = document.getElementById('nickname');
    const assuntoSelect = document.getElementById('assunto');

    nicknameInput.addEventListener('blur', async () => {
      const nickname = nicknameInput.value.trim();
      if (!nickname) {
        assuntoSelect.innerHTML = '<option value="">--Informe um nickname válido--</option>';
        return;
      }

      try {
        const res = await fetch(`/buscarAssunto?nickname=${encodeURIComponent(nickname)}`);
        if (!res.ok) throw new Error('Nickname não encontrado');
        const data = await res.json();
        if (data.assunto) {
          assuntoSelect.innerHTML = `<option value="${data.assunto}">${data.assunto}</option>`;
        } else {
          assuntoSelect.innerHTML = '<option value="">--Nenhum assunto encontrado--</option>';
        }
      } catch {
        assuntoSelect.innerHTML = '<option value="">--Nickname inválido ou não cadastrado--</option>';
      }
    });
  </script>
</body>
</html>
